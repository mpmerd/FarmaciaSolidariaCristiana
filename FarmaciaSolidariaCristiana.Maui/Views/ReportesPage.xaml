<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:FarmaciaSolidariaCristiana.Maui.ViewModels"
             x:Class="FarmaciaSolidariaCristiana.Maui.Views.ReportesPage"
             x:DataType="viewmodels:ReportesViewModel"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource BackgroundColor}">

    <ScrollView>
        <StackLayout Padding="20" Spacing="20">
            <!-- Header -->
            <Frame BackgroundColor="{StaticResource Primary}" 
                   CornerRadius="15" 
                   Padding="20"
                   HasShadow="True">
                <StackLayout>
                    <Label Text="ðŸ“Š Generador de Reportes" 
                           FontSize="22" 
                           FontAttributes="Bold"
                           TextColor="White"/>
                    <Label Text="Genera reportes PDF de actividad" 
                           FontSize="14" 
                           TextColor="#B0D4FF"/>
                </StackLayout>
            </Frame>

            <!-- Status Message -->
            <Label Text="{Binding StatusMessage}" 
                   IsVisible="{Binding StatusMessage, Converter={StaticResource StringToBoolConverter}}"
                   FontSize="14"
                   TextColor="{StaticResource Primary}"
                   HorizontalOptions="Center"/>

            <!-- Date Range for Entregas and Donaciones -->
            <Frame BackgroundColor="White" CornerRadius="15" Padding="20" HasShadow="True">
                <StackLayout Spacing="15">
                    <Label Text="ðŸ“… Reportes por Rango de Fechas" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="{StaticResource Dark}"/>
                    
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                        <StackLayout Grid.Column="0" Spacing="5">
                            <Label Text="Desde:" FontSize="14" TextColor="{StaticResource Gray600}"/>
                            <DatePicker Date="{Binding FechaInicio}"
                                        BackgroundColor="{StaticResource Gray100}"
                                        MinimumDate="2020-01-01"
                                        MaximumDate="{Binding FechaFin}"/>
                        </StackLayout>
                        
                        <StackLayout Grid.Column="1" Spacing="5">
                            <Label Text="Hasta:" FontSize="14" TextColor="{StaticResource Gray600}"/>
                            <DatePicker Date="{Binding FechaFin}"
                                        BackgroundColor="{StaticResource Gray100}"
                                        MinimumDate="{Binding FechaInicio}"/>
                        </StackLayout>
                    </Grid>
                    
                    <!-- Entregas Report -->
                    <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="12" Padding="0" HasShadow="False">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding GenerateEntregasReportCommand}"/>
                        </Frame.GestureRecognizers>
                        <Grid ColumnDefinitions="Auto,*,Auto" Padding="15">
                            <Frame Grid.Column="0" 
                                   WidthRequest="45" 
                                   HeightRequest="45" 
                                   CornerRadius="22"
                                   BackgroundColor="#E0F7FA"
                                   BorderColor="Transparent"
                                   Padding="0">
                                <Label Text="ðŸšš" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center"/>
                            </Frame>
                            <StackLayout Grid.Column="1" VerticalOptions="Center" Padding="12,0">
                                <Label Text="Reporte de Entregas" FontSize="15" FontAttributes="Bold" TextColor="{StaticResource Dark}"/>
                                <Label Text="Entregas realizadas en el perÃ­odo" FontSize="12" TextColor="{StaticResource Gray600}"/>
                            </StackLayout>
                            <Label Grid.Column="2" Text="â€º" FontSize="24" TextColor="{StaticResource Primary}" VerticalOptions="Center" FontAttributes="Bold"/>
                        </Grid>
                    </Frame>

                    <!-- Donaciones Report -->
                    <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="12" Padding="0" HasShadow="False">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding GenerateDonacionesReportCommand}"/>
                        </Frame.GestureRecognizers>
                        <Grid ColumnDefinitions="Auto,*,Auto" Padding="15">
                            <Frame Grid.Column="0" 
                                   WidthRequest="45" 
                                   HeightRequest="45" 
                                   CornerRadius="22"
                                   BackgroundColor="#FCE4EC"
                                   BorderColor="Transparent"
                                   Padding="0">
                                <Label Text="â¤ï¸" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center"/>
                            </Frame>
                            <StackLayout Grid.Column="1" VerticalOptions="Center" Padding="12,0">
                                <Label Text="Reporte de Donaciones" FontSize="15" FontAttributes="Bold" TextColor="{StaticResource Dark}"/>
                                <Label Text="Donaciones recibidas en el perÃ­odo" FontSize="12" TextColor="{StaticResource Gray600}"/>
                            </StackLayout>
                            <Label Grid.Column="2" Text="â€º" FontSize="24" TextColor="{StaticResource Primary}" VerticalOptions="Center" FontAttributes="Bold"/>
                        </Grid>
                    </Frame>
                </StackLayout>
            </Frame>

            <!-- Monthly Report Section -->
            <Frame BackgroundColor="White" CornerRadius="15" Padding="20" HasShadow="True">
                <StackLayout Spacing="15">
                    <Label Text="ðŸ“† Reporte Mensual General" 
                           FontSize="18" 
                           FontAttributes="Bold"
                           TextColor="{StaticResource Dark}"/>
                    
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                        <StackLayout Grid.Column="0" Spacing="5">
                            <Label Text="AÃ±o:" FontSize="14" TextColor="{StaticResource Gray600}"/>
                            <Picker ItemsSource="{Binding AvailableYears}"
                                    SelectedItem="{Binding SelectedYear}"
                                    BackgroundColor="{StaticResource Gray100}"/>
                        </StackLayout>
                        
                        <StackLayout Grid.Column="1" Spacing="5">
                            <Label Text="Mes:" FontSize="14" TextColor="{StaticResource Gray600}"/>
                            <Picker ItemsSource="{Binding AvailableMonths}"
                                    SelectedIndex="{Binding SelectedMonth, Converter={StaticResource MonthIndexConverter}}"
                                    BackgroundColor="{StaticResource Gray100}"/>
                        </StackLayout>
                    </Grid>

                    <!-- Monthly Report Button -->
                    <Frame BackgroundColor="{StaticResource Primary}" CornerRadius="12" Padding="0" HasShadow="False">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding GenerateMensualReportCommand}"/>
                        </Frame.GestureRecognizers>
                        <Grid ColumnDefinitions="Auto,*,Auto" Padding="15">
                            <Frame Grid.Column="0" 
                                   WidthRequest="45" 
                                   HeightRequest="45" 
                                   CornerRadius="22"
                                   BackgroundColor="White"
                                   BorderColor="Transparent"
                                   Padding="0">
                                <Label Text="ðŸ“Š" FontSize="20" HorizontalOptions="Center" VerticalOptions="Center"/>
                            </Frame>
                            <StackLayout Grid.Column="1" VerticalOptions="Center" Padding="12,0">
                                <Label Text="Generar Reporte Mensual" FontSize="15" FontAttributes="Bold" TextColor="White"/>
                                <Label Text="Resumen completo del mes" FontSize="12" TextColor="#B0D4FF"/>
                            </StackLayout>
                            <Label Grid.Column="2" Text="â€º" FontSize="24" TextColor="White" VerticalOptions="Center" FontAttributes="Bold"/>
                        </Grid>
                    </Frame>
                </StackLayout>
            </Frame>

            <!-- Loading -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               Color="{StaticResource Primary}"
                               HeightRequest="40"/>
        </StackLayout>
    </ScrollView>
</ContentPage>
